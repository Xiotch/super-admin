<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Manage License • Super Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/css/style.css" rel="stylesheet">
</head>
<body>
<div class="container py-4" style="max-width:760px;">
  <a href="./index.html" class="btn btn-outline-secondary mb-3">← Back</a>
  <h4 class="mb-3">Manage License</h4>
  <div id="alert" class="alert d-none"></div>

  <div class="card p-4">
    <div class="mb-3">
      <label class="form-label">Restaurant ID (subdomain)</label>
      <input id="id" class="form-control" placeholder="cafearoma">
    </div>
    <div class="mb-3">
      <label class="form-label">License Expiry</label>
      <input id="license_expiry" type="date" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">Status</label>
      <select id="status" class="form-select">
        <option value="active">Active</option>
        <option value="suspended">Suspended</option>
        <option value="expired">Expired</option>
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Owner UID (link after owner signs up)</label>
      <input id="owner_uid" class="form-control" placeholder="(paste restaurant owner's uid)">
    </div>
    <button id="save" class="btn btn-brand">Save</button>
  </div>
</div>

<script src="../assets/js/firebase-config.js"></script>
<script type="module">
  import { auth, db } from "../assets/js/firebase-init.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const alertEl = document.getElementById('alert');
  function show(type,msg){ alertEl.className = `alert alert-${type}`; alertEl.textContent = msg; alertEl.classList.remove('d-none'); }

  onAuthStateChanged(auth, async (user)=>{
    if (!user) return location.href='./login.html';
    // role check could be added like in other pages
  });

  document.getElementById('save').addEventListener('click', async ()=>{
    const id = document.getElementById('id').value.trim();
    if (!id) return show('warning','Enter restaurant id');
    try {
      const ref = doc(db, "restaurants", id);
      const snap = await getDoc(ref);
      if (!snap.exists()) return show('danger','Restaurant not found');
      await updateDoc(ref, {
        license_expiry: document.getElementById('license_expiry').value,
        status: document.getElementById('status').value,
        owner_uid: document.getElementById('owner_uid').value.trim() || null
      });
      show('success','Updated');
    } catch(e){ show('danger', e.message); }
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
